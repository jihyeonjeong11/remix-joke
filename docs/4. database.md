ë°ì´í„°ë² ì´ìŠ¤ì— ë†ë‹´ê³¼ authenticationì„ ì €ì¥í•  ê²ƒì„.

You can use any persistence solution you like with Remix; Firebase, Supabase, Airtable, Hasura, Google Spreadsheets, Cloudflare Workers KV, Fauna, a custom PostgreSQL, or even your backend team's REST/GraphQL APIs. Seriously. Whatever you want.

ìœ„ ê²ƒë“¤ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?? ê·¸ë ‡ë‹¤ë©´ ì„œë²„ + ì„œë²„ + í”„ë¡ íŠ¸ êµ¬ì¡°ê°€ ë˜ëŠ”ê²ƒì¸ê°€???

npm run buildë¡œ í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ

npm serveë¡œ ì„œë²„ ë¹Œë“œí•´ì„œ ë‘˜ë‹¤ ì˜¬ë¦¬ë©´ ë ê±°ê°™ë‹¤.

### ë°ì´í„°ë² ì´ìŠ¤ - prisma

SQLiteë¥¼ ì‚¬ìš©í•˜ê³ , Prismaë¼ëŠ” ì• ë¥¼ ê¹”ì•„ì„œ ì‚¬ìš©í•¨.

```
prisma
@prisma/client

// ë‘ ê°€ì§€ë¥¼ ì„¤ì¹˜í•  ê²ƒì„

 npm install --save-dev prisma
npm install @prisma/client
// ì„¤ì¹˜í›„

//ì»¤ë§¨ë“œë¡œ ì¼ ë‹¤
npx prisma init --datasource-provider sqlite

```

ìš”ê¸°ê¹Œì§€ ì˜¤ë©´ ë‚˜ì˜¤ëŠ” ë©”ì‹œì§€ê°€

```
âœ” Your Prisma schema was created at prisma/schema.prisma
  You can now open it in your favorite editor.

warn You already have a .gitignore. Don't forget to exclude .env to not commit any secret.

Next steps:
1. Set the DATABASE_URL in the .env file to point to your existing database. If your database has no tables yet, read https://pris.ly/d/getting-started
2. Run prisma db pull to turn your database schema into a Prisma schema.
3. Run prisma generate to generate the Prisma Client. You can then start querying your database.

More information in our documentation:
https://pris.ly/d/getting-started
```

1. DATABASE_URL ì •í•˜ê¸°
2. run prisma db pull
3. run prisma generate

prisma/schema.prismaê°€ ìƒì„±ë¨.

ì—¬ê¸°ì— urlì˜ Joke modelì„ ìƒì„±í•´ ì¤€ë‹¤.

```
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Joke {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  name       String
  content    String
}
```

ì´í›„ npx prisma db push

```
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.db" at "file:./dev.db"

SQLite database dev.db created at file:./dev.db

ğŸš€  Your database is now in sync with your Prisma schema. Done in 21ms

âœ” Generated Prisma Client (4.4.0 | library) to ./node_modules/@prisma/client in
104ms

```

prisma/dev.dbì— db ìƒì„±
ìŠ¤í‚¤ë§ˆì— ì„¤ì •ëœ ê°’ migrate, ê·¸ë¦¬ê³  type íŒŒì¼ ìƒì„±í•¨
<br/>

gitignoreì— /prisma/dev.db ì„¤ì •í•´ì¤€ë‹¤.

```
If your database gets messed up, you can always delete the prisma/dev.db file and run npx prisma db push again. Remember to also restart your dev server with npm run dev.
```

ë§Œì•½ db í…Œì´ë¸”ì´ ê¼¬ì˜€ë‹¤ë©´, prisma/dev.dbë¥¼ ì§€ìš°ê³  npx prisma db push ë¥¼ ë‹¤ì‹œ í•´ì¤€ë‹¤.

prisma/seed.tsë¥¼ ìƒì„±í•´ ì½”ë“œ ë„£ì–´ì¤€ë‹¤.(ê¸°ë³¸ db í…Œì´ë¸” ë‚´ìš©)

í•´ë‹¹ seed íŒŒì¼ì€ tsì´ë¯€ë¡œ, typescriptë¥¼ ë³€í™˜í•´ì£¼ì–´ì•¼ í•œë‹¤.

```
yarn install -D esbuild-register
// typescript íŠ¸ëœìŠ¤íŒŒì¼ëŸ¬
// ì™œ ts-nodeê°€ ì•„ë‹Œê°€?
// https://twitter.com/housecor/status/1498647037411315716?lang=en
// ì†ë„ê°€ ë” ë¹ ë¥¸ë“¯?
```

ê·¸ë¦¬ê³  package.jsonì—

```
// ...
  "prisma": {
    "seed": "node --require esbuild-register prisma/seed.ts"
  },
  "scripts": {
// ...
```

ì„ ë“±ë¡í•´ ì¤€ë‹¤.

nextJSì™€ë„ ë§ˆì°¬ê°€ì§€ë¡œ, serverside ì½”ë“œ ë³€ê²½ì‹œë§ˆë‹¤ db connectionìœ¼ë¡œ ìƒˆë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë ¤ë©´,

app/utils/db.server.tsë¥¼ ì„¤ì •í•´ ì¤€ë‹¤.

### Remix loader ì„¸íŒ…

ìœ„ì—ì„œ ì„¤ì •í•œ dbë¥¼ Remixì—ì„œ ì½ì–´ì˜¤ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤.

ë¦¬ë¯¹ìŠ¤ì—ì„œëŠ” loader í‘ì…˜ìœ¼ë¡œ dbì™€ í†µì‹ í•œë‹¤.

```
// this is just an example. No need to copy/paste this ğŸ˜„
import type { LoaderFunction } from "@remix-run/node";
import { json } from "@remix-run/node";
import { useLoaderData } from "@remix-run/react";
import type { Sandwich } from "@prisma/client";

import { db } from "~/utils/db.server";

type LoaderData = { sandwiches: Array<Sandwich> };

export const loader: LoaderFunction = async () => {
  const data: LoaderData = {
    sandwiches: await db.sandwich.findMany(),
  };
  return json(data);
};

export default function Sandwiches() {
  const data = useLoaderData<LoaderData>();
  return (
    <ul>
      {data.sandwiches.map((sandwich) => (
        <li key={sandwich.id}>{sandwich.name}</li>
      ))}
    </ul>
  );
}
```

ìœ„ ì˜ˆë¥¼ ë³´ë©´ì„œ app/routes/jokes.tsxì— loader ë¥¼ ì¶”ê°€í•œë‹¤.

### Data overfetching

ì“¸ëª¨ì—†ëŠ” propsë¥¼ ì¤„ì´ê±°ë‚˜, ì—¬ëŸ¬ ì„¸íŒ…ì„ ì¤„ë•Œë¥¼

```
type LoaderData = {
  jokeListItems: Array<{ id: string; name: string }>;
};

export const loader: LoaderFunction = async () => {
  const data: LoaderData = {
    jokeListItems: await db.joke.findMany({
      take: 5,
      select: { id: true, name: true },
      orderBy: { createdAt: "desc" },
    }),
  };
  return json(data);
};

```

ì´ëŸ°ì‹ìœ¼ë¡œ ë°”ê¾¸ì–´ ì¤€ë‹¤.

### Network Type Safety

ìœ„ loaderëŠ” backendì—ì„œ, LoaderFunction typeì€ í”„ë¡ íŠ¸ì—ì„œ ì •ì˜ëœ ê²ƒì„ ì£¼ëª©í•´ì•¼ í•œë‹¤,.

ê·¸ëŸ¬ë¯€ë¡œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì™„ë²½í•˜ê²Œ type ì„ ë§ì¶”ë ¤ë©´ assertion functionì„ ì‚¬ìš©í•´ì•¼ í•¨.

https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#assertion-functions
https://www.npmjs.com/package/zod

ë‚˜ì¤‘ì— í•œë²ˆ í•´ë³´ë¼ê³  ë˜ì–´ìˆë¯€. (assertion functionsì™€ zodë¼ëŠ” ì• ë¡œ)

//ì°¸ê³ 
prismaì—ì„œ raw queryë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
https://www.prisma.io/docs/concepts/components/prisma-client/raw-database-access

### Wrap up ddatabase queries

ìœ„ ë§Œë“  ì¿¼ë¦¬ë¥¼ dynamic routingí•œ endpoint $jokeIdì—ì„œ ë°›ì„ ìˆ˜ ì‡ë„ë¡ ì„¸íŒ…í•œë‹¤.

```
export const loader: LoaderFunction = async ({
  params,
}) => {
  console.log(params); // <-- {jokeId: "123"}
};

```

```
const joke = await db.joke.findUnique({
  where: { id: jokeId },
});
```

Remember, when we're referencing the URL route, it's /jokes/:jokeId, and when we talk about the file system it's /app/routes/jokes/$jokeId.tsx.

/jokes/!jokeIdë¼ê³  í•œë‹¤ë©´ ì´ëŠ” ì‹¤ì œ í”„ë¡œì íŠ¸ìƒì—ì„œ /app/routes/jokes/$jokeId.tsxê°€ ëœë‹¤.
